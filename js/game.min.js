/**
 * The Bank Job
 *
 * Copyright (c) 2014 Petar Petrov
 *
 * This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.
 * To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/.
 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";function c(a,b,c,d,e){a.physics.arcade.enable(b),b.body.immovable=d,b.body.collideWorldBounds="undefined"!=typeof e?e:!1,c?b.body.setSize(c[0],c[1],c[2],c[3]):b.body.setSize(b.width,b.height)}function d(a,b,c,d,e){var f=d||a.width/2,g=e||a.height/2;return{x:f+Math.random()*b*a.math.randomSign(),y:g+Math.random()*c*a.math.randomSign()}}function e(a){this.game=a,this.roomGroup=this.game.add.group(),this.actorGroup=this.game.add.group();var b={font:"22px Arial",fill:"#2A2A2A"};this.msg=a.add.text(a.width/2-75,a.height/2-50,"",b),this.msg.setShadow(3,3,"rgba(0,0,0,0.5)",5)}var f=a("lodash"),g=a("./globals");e.prototype={init:function(){this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.physics.arcade.setBounds(145,140,670,425)},addAudio:function(){var a={};return a.door1=this.game.add.sound("door1"),a.door2=this.game.add.sound("door2"),a.pickupkey=this.game.add.sound("pickupkey"),a.walk2=this.game.add.sound("walk2"),a.walk3=this.game.add.sound("walk3"),a.alarm1=this.game.add.sound("alarm1"),a.alarm2=this.game.add.sound("alarm2"),a.music=this.game.add.sound("music"),a},addText:function(a,b){this.msg.alpha=1,this.msg.setText(a);var c=this.game.add.tween(this.msg).to({alpha:0},g.TEXT_DELAY,Phaser.Easing.Quartic.In,!0,0,0,!1);b&&c.onComplete.add(b)},addPlayer:function(a,b){var d=g.PLAYER_WALK_ANIM_SPEED,e=this.game.add.sprite(a,b,"protagonist");return e.animations.add("walk",[0,1,2,1],d,!0),e.anchor.set(.5,.5),c(this.game,e,[50,6,8,26],!1,!0),this.actorGroup.add(e),e},addMonster:function(a,b){var d=g.PLAYER_WALK_ANIM_SPEED,e=this.game.add.sprite(a,b,"monster");return e.animations.add("walk",[0,1,2,1],d,!0),e.anchor.set(.5),c(this.game,e,[40,11,4,26],!1,!0),this.actorGroup.add(e),e},addMonsters:function(a){return f.forEach(a,function(a){var b=d(this.game,75,75),c=this.addMonster(b.x,b.y);c.exists=!1,a.obj=c},this),a},addRoom:function(a,b,e,h){var i,j,k=this,l={},m=a.rooms[b];if(l.doors=[],l.artifacts=[],this.roomGroup.add(this.game.add.sprite(0,0,"room01")),f.forEach(m.scheme.doors,function(a){var b,d;switch(a){case g.DN:b=k.game.add.sprite(480,74,"door_north",0),d=[160,4,2,66];break;case g.DS:b=k.game.add.sprite(480,565,"door_south",0),d=[160,4,2,0];break;case g.DW:b=k.game.add.sprite(105,320,"door_west",0),d=[4,165,40,0];break;case g.DE:b=k.game.add.sprite(855,320,"door_east",0),d=[4,165,-40,0];break;default:throw"check your head boy!"}b.aim=a,b.anchor.set(.5,.5),c(k.game,b,d,!0),l.doors.push(b),b.isOpen=!1,b.isRed=!1,m.scheme.redDoor===a&&(b.tint=16715535,b.isRed=!0),k.roomGroup.add(b)}),f.forEach(e,function(b){if(b.roomIdx===m.idx){b.obj.exists=!0;var c=d(this.game,35,35);b.obj.x=c.x,b.obj.y=c.y}else if(b.erratic)if(this.game.math.chanceRoll(a.spawnChance)){g.debug(a.spawnChance+"% chance enemy spawned");var c=d(this.game,35,35);b.obj.x=c.x,b.obj.y=c.y,b.obj.exists=!0,b.type=this.game.math.getRandom([g.MONSTER01,g.MONSTER02]),a.spawnChance=g.SPAWN_COP_CHANCE}else a.spawnChance+=g.SPAWN_COP_CHANCE},this),m.scheme.hasKey&&(i=d(this.game,200,200),l.key=this.addKey(i.x,i.y)),j=this.addArtefact(m.scheme.art1),j&&l.artifacts.push(j),j=this.addArtefact(m.scheme.art2),j&&l.artifacts.push(j),b===a.playerPos){var j=this.addBags();l.artifacts.push(j)}if("undefined"!=typeof h){this.roomGroup.alpha=.125;var n=this.game.add.tween(this.roomGroup).to({alpha:1},g.ROOM_ENTER_DELAY,Phaser.Easing.Linear.None,!0,0,0,!1);n.onComplete.add(h)}return m.obj=l,m},addArtefact:function(a){var b;switch(a){case g.PLANT01:b=this.game.add.sprite(755,105,"plant",0);break;case g.PLANT02:b=this.game.add.sprite(155,105,"plant",1);break;case g.CHAIR01:b=this.game.add.sprite(155,105,"chair",0);break;case g.CHAIR02:b=this.game.add.sprite(755,105,"chair",1);break;case g.CHAIR03:b=this.game.add.sprite(150,505,"chair",2);break;case g.CHAIR04:b=this.game.add.sprite(785,500,"chair",3)}return b&&(this.roomGroup.add(b),c(this.game,b,null,!0)),b},addBags:function(){var a=this.game.add.sprite(110,g.SCREEN_HEIGHT-220,"bags");return c(this.game,a,[141,141,0,20],!0),this.roomGroup.add(a),a},addTombstone:function(a,b){var c=this.game.add.sprite(a,b,"tombstone");return c.anchor.set(.5),this.actorGroup.add(c),c},addKey:function(a,b){var d=this.game.add.sprite(a,b,"bankkey");return d.animations.add("twinkle",[0,1,2],3,!0),d.play("twinkle"),d.anchor.set(.5),c(this.game,d,[24,35,0,10],!0),this.roomGroup.add(d),d},destroyRoom:function(a,b){this.roomGroup.destroy(!0,!0),f.forEach(b,function(a){a.obj.exists=!1},this)},destroyAll:function(){this.roomGroup.destroy(!0,!1),this.actorGroup.destroy(!0,!1)},fadeoutAll:function(a,b){this.game.add.tween(this.actorGroup).to({alpha:0},a,Phaser.Easing.Linear.None,!0,0,0,!1);var c=this.game.add.tween(this.roomGroup).to({alpha:0},a,Phaser.Easing.Linear.None,!0,0,0,!1);c.onComplete.add(b)},generateRoomsGrid:function(a,b){var c,d,e,f=a*b,h=[],i=a/2+b/2*a;for(d=0;b>d;d++)for(c=0;a>c;c++){e=c+d*a;var j={scheme:{doors:[],hasKey:!1}};j.idx=e,c>0&&a-1>c?(j.scheme.doors.push(g.DW),j.scheme.doors.push(g.DE)):0===c?j.scheme.doors.push(g.DE):c===a-1&&j.scheme.doors.push(g.DW),d>0&&b-1>d?(j.scheme.doors.push(g.DN),j.scheme.doors.push(g.DS)):0===d?j.scheme.doors.push(g.DS):d===b-1&&j.scheme.doors.push(g.DN),h[e]=j}return h[f-2].scheme.hasKey=!0,h[f-1].scheme.doors.push(g.DE),h[f-1].scheme.redDoor=g.DE,{playerPos:i,endRoom:14,keyRoom:15,rooms:h,spawnChance:g.SPAWN_COP_CHANCE}},generateMaze:function(a,b){var c,d,e=a*b,h=[],i=[g.DN,g.DS,g.DW,g.DE],j=a/2+b/2*a,k=[g.PLANT01,0,g.CHAIR01,g.PLANT02,g.CHAIR02],l=[g.CHAIR03,0,g.CHAIR04];for(d=0;b>d;d++)for(c=0;a>c;c++){var m=c+d*a,n={scheme:{doors:[],hasKey:!1,art1:this.game.math.getRandom(k),art2:this.game.math.getRandom(l)}};n.idx=m,n.x=c,n.y=d,h[m]=n}for(var o,p,q=function(c){var d=[],e=h[c].x,f=h[c].y;return e-1>=0&&0===h[c-1].scheme.doors.length&&d.push({idx:c-1,door:g.DW}),a>e+1&&0===h[c+1].scheme.doors.length&&d.push({idx:c+1,door:g.DE}),f-1>=0&&0===h[c-a].scheme.doors.length&&d.push({idx:c-a,door:g.DN}),b>f+1&&0===h[c+a].scheme.doors.length&&d.push({idx:c+a,door:g.DS}),d},r=function(a){switch(a){case g.DN:return g.DS;case g.DS:return g.DN;case g.DW:return g.DE;case g.DE:return g.DW}throw"No doors avail. dude!"},s=function(a){var b=f.difference(i,h[a].scheme.doors),c=this.game.math.getRandom(b);return h[a].scheme.doors.push(c),h[a].scheme.redDoor=c,a}.bind(this),t=[],u=j,v=-1,w=-1,x=1;e>x;)o=q(u),o.length>0?(p=this.game.math.getRandom(o),h[u].scheme.doors.push(p.door),h[p.idx].scheme.doors.push(r(p.door)),t.push(u),u=p.idx,x++):(-1===v&&(v=s(u),g.debug("exit at: "+u)),u=t.pop());for(-1===v&&(g.debug("exit at end path: "+u),v=s(u)),m=h.length-1;m>=0;m--){var y=h[m].scheme;if(1===y.doors.length&&m!==j&&m!==v){y.hasKey=!0,g.debug("key at: "+m),w=m;break}}if(-1===w)for(console.error("Something messed while generating end points! :( Sorry, pls restart!");-1===w;)if(p=this.game.math.getRandom(h),p.idx!==j&&p.idx!==v){w=p.idx,p.scheme.hasKey=!0,g.debug("key at somepath: "+w);break}return{playerPos:j,endRoom:v,keyRoom:w,rooms:h,spawnChance:g.SPAWN_COP_CHANCE}},generateMonsters:function(a){var b=[];b.push({roomIdx:a.endRoom,type:g.MONSTER01}),b.push({roomIdx:a.keyRoom,type:g.MONSTER01}),b.push(this.game.math.chanceRoll(50)?{roomIdx:a.keyRoom,type:g.MONSTER02}:{roomIdx:a.endRoom,type:g.MONSTER02});for(var c=a.rooms.length-1;c>=0;c--){var d=a.rooms[c].scheme;d.doors.length>=3&&(b.push({roomIdx:c,type:g.MONSTER01}),g.debug("ghost at 3 doors room: "+c))}return b.push({roomIdx:-1,type:g.MONSTER02,erratic:!0}),f.each(b,function(a){a.trackTime=0}),b},updateDepths:function(a){a.length>0&&this.actorGroup.sort("y")}},b.exports=e},{"./globals":2,lodash:11}],2:[function(a,b){"use strict";var c={PLAYER_SPEED:101,PLAYER_WALK_ANIM_SPEED:10,MONSTER_SPEED:54,MONSTER_ACC:108,MONSTER_MAXSPEED:160,MONSTER_ACC_DELAY:2800,SPAWN_COP_CHANCE:25,DN:10,DS:11,DW:12,DE:13,ROOMS_X:4,ROOMS_Y:4,MONSTER01:91,MONSTER02:92,PLANT01:101,PLANT02:102,CHAIR01:111,CHAIR02:112,CHAIR03:113,CHAIR04:114,SCREEN_WIDTH:960,SCREEN_HEIGHT:640,TEXT_DELAY:2500,ROOM_ENTER_DELAY:850,GAMEEND_FADE_DELAY:3e3,enableDebug:!1,debug:function(){if(this.enableDebug){var a=Array.prototype.slice.call(arguments,0);console.log(a)}},error:function(){if(this.enableDebug){var a=Array.prototype.slice.call(arguments,0);console.error(a)}},math:{PI:3.14159265358979,PI2:6.28318530716,PI_2:1.5707963267948966,PI_4:.3926990817,PI3_2:4.71238898037}};b.exports=c},{}],3:[function(a){"use strict";window.onload=function(){var b=new Phaser.Game(960,640,Phaser.AUTO,"thebankjob");b.state.add("boot",a("./states/boot")),b.state.add("gameintro",a("./states/gameintro")),b.state.add("gameover",a("./states/gameover")),b.state.add("gamewin",a("./states/gamewin")),b.state.add("menu",a("./states/menu")),b.state.add("play",a("./states/play")),b.state.add("preload",a("./states/preload")),b.state.start("boot")}},{"./states/boot":4,"./states/gameintro":5,"./states/gameover":6,"./states/gamewin":7,"./states/menu":8,"./states/play":9,"./states/preload":10}],4:[function(a,b){"use strict";function c(){}c.prototype={preload:function(){this.load.image("preloader","assets/preloader.gif")},create:function(){this.game.input.maxPointers=1,this.game.state.start("preload")}},b.exports=c},{}],5:[function(a,b){"use strict";function c(){}c.prototype={preload:function(){},create:function(){var a,b={font:"18px Arial",fill:"#131313",align:"center"},c={font:"15px Arial",fill:"#131313",align:"center"};this.game.stage.backgroundColor="#ffffff",this.sprite=this.game.add.sprite(this.game.world.centerX,138,"bags"),this.sprite.angle=115,this.game.add.tween(this.sprite).to({angle:160},2e3,Phaser.Easing.Linear.NONE,!0,0,5e3,!0),this.sprite.anchor.setTo(.5,.5),a=this.game.add.text(this.game.world.centerX,260,"Fed up with your boring job as a bank clerk you decide to rob the bank",b),a.anchor.setTo(.5,.5),a=this.game.add.text(this.game.world.centerX,280,"and spend the rest of your days on a sunny island. You've got the money ",b),a.anchor.setTo(.5,.5),a=this.game.add.text(this.game.world.centerX,300,"and now you just need to escape without getting caught.",b),a.anchor.setTo(.5,.5),a=this.game.add.text(this.game.world.centerX,380,"Use Arrow keys or WASD keys to move.",b),a.anchor.setTo(.5,.5),a=this.game.add.text(this.game.world.centerX,400,"Press Enter or Space key to open doors.",b),a.anchor.setTo(.5,.5),a=this.game.add.text(this.game.world.centerX,485,"Click anywhere to start",b),a.anchor.setTo(.5,.5),a=this.game.add.text(735,580,"Press 'N 'to toggle Sound on/off",c),a=this.game.add.text(735,600,"Press 'M' to toggle Music on/off",c)},update:function(){this.game.input.activePointer.justPressed()&&this.game.state.start("play")}},b.exports=c},{}],6:[function(a,b){"use strict";function c(){}c.prototype={preload:function(){},create:function(){var a={font:"65px Arial",fill:"#131313",align:"center"},b={font:"18px Arial",fill:"#A1A1A1",align:"center"},c={font:"18px Arial",fill:"#131313",align:"center"};this.game.stage.backgroundColor="#ffffff",this.titleText=this.game.add.text(this.game.world.centerX,100,"Game Over",a),this.titleText.setShadow(3,3,"#A1A1A1",5),this.titleText.anchor.setTo(.5,.5),this.congratsText=this.game.add.text(this.game.world.centerX,200,"You have been caught!",b),this.congratsText.anchor.setTo(.5,.5),this.congratsText=this.game.add.text(this.game.world.centerX,250,"See you in 20 years time.",b),this.congratsText.anchor.setTo(.5,.5),this.instructionText=this.game.add.text(this.game.world.centerX,475,"Click anywhere to continue",c),this.instructionText.anchor.setTo(.5,.5),this.addCop(this.game.world.centerX,320),this.addCop(this.game.world.centerX-65,320),this.addCop(this.game.world.centerX+65,320),this.addCop(this.game.world.centerX,380,"protagonist")},addCop:function(a,b,c){c=c||"monster",this.sprite=this.game.add.sprite(a,b,c,1),this.sprite.angle=180,this.sprite.anchor.setTo(.5,.5)},update:function(){this.game.input.activePointer.justPressed()&&this.game.state.start("menu")}},b.exports=c},{}],7:[function(a,b){"use strict";function c(){}c.prototype={preload:function(){},create:function(){var a={font:"65px Arial",fill:"#131313",align:"center"},b={font:"18px Arial",fill:"#A1A1A1",align:"center"},c={font:"18px Arial",fill:"#131313",align:"center"};this.game.stage.backgroundColor="#ffffff",this.titleText=this.game.add.text(this.game.world.centerX,100,"You have escaped!",a),this.titleText.setShadow(3,3,"#A1A1A1",5),this.titleText.anchor.setTo(.5,.5),this.congratsText=this.game.add.text(this.game.world.centerX,200,"The money is yours.",b),this.congratsText.anchor.setTo(.5,.5),this.sprite=this.game.add.sprite(this.game.world.centerX,320,"bags"),this.sprite.angle=115,this.sprite.anchor.setTo(.5,.5),this.instructionText=this.game.add.text(this.game.world.centerX,475,"Click anywhere to continue",c),this.instructionText.anchor.setTo(.5,.5)},update:function(){this.game.input.activePointer.justPressed()&&this.game.state.start("menu")}},b.exports=c},{}],8:[function(a,b){"use strict";function c(){}c.prototype={preload:function(){},create:function(){var a,b={font:"65px Arial",fill:"#131313",align:"center"},c={font:"18px Arial",fill:"#A1A1A1",align:"center"},d={font:"18px Arial",fill:"#131313",align:"center"},e={font:"14px Arial",fill:"#A1A1A1",align:"center"};this.game.stage.backgroundColor="#ffffff",this.sprite=this.game.add.sprite(this.game.world.centerX,138,"bags"),this.sprite.angle=115,this.game.add.tween(this.sprite).to({angle:160},2e3,Phaser.Easing.Linear.NONE,!0,0,5e3,!0),this.sprite.anchor.setTo(.5,.5),a=this.game.add.text(this.game.world.centerX,250,"The Bank Job",b),a.setShadow(3,3,"#A1A1A1",5),a.anchor.setTo(.5,.5),a=this.game.add.text(this.game.world.centerX,320,"by Dvubuz Games",c),a.anchor.setTo(.5,.5),a.anchor.setTo(.5,.5),a=this.game.add.text(this.game.world.centerX,455,"Click anywhere to start",d),a.anchor.setTo(.5,.5),a=this.game.add.text(25,580,"Coding & Sfx by Petar Petrov",e),a=this.game.add.text(25,600,"Art by Stremena Tuzsuzova",e),this.music=this.game.add.sound("music"),this.music.loop=!0,this.music.play()},update:function(){this.game.input.activePointer.justPressed()&&this.game.state.start("gameintro")},shutdown:function(){this.music.stop(),this.music.destroy()}},b.exports=c},{}],9:[function(a,b){"use strict";function c(){}var d=a("lodash"),e=a("../globals"),f=a("../gamefactory");c.prototype={create:function(){this.game.stage.backgroundColor="#ffffff",this.gamecx=this.game.width/2,this.gamecy=this.game.height/2,this.gamefactory=new f(this.game),this.gamefactory.init(),this.sfx=this.gamefactory.addAudio(),this.maze=this.gamefactory.generateMaze(e.ROOMS_X,e.ROOMS_Y),this.monsters=this.gamefactory.addMonsters(this.gamefactory.generateMonsters(this.maze)),this.player=this.gamefactory.addPlayer(this.gamecx,this.gamecy),this.player.lastOpenTime=0,this.player.lastWalkSndTime=0,this.player.lastAlarmTime=0,this.player.musicKeyTime=0,this.enterRoom(this.maze.playerPos,this.gamecx,this.gamecy,!0),this.stopUpdate=!1,this.player.hasKey=!1,this.soundOn=!0,this.cursors=this.game.input.keyboard.createCursorKeys();var a={font:"12px Arial",fill:"#1A1A1A"};this.game.time.advancedTiming=!0,this.texts={},e.enableDebug&&(this.texts.fps=this.game.add.text(this.game.width-70,5,"fps:",a),this.texts.pos=this.game.add.text(this.game.width-70,16,"pos:",a),this.texts.end=this.game.add.text(this.game.width-70,26,"end:",a),this.texts.key=this.game.add.text(this.game.width-70,36,"key:",a)),this.gamefactory.addText("Find the Red door.",function(){this.gamefactory.addText("Beware of the cops!")}.bind(this)),this.playMusic(!0)},update:function(a){if(!this.stopUpdate){var b,c,f=this.player,g=f.room,h=this;e.enableDebug&&(this.texts.fps.setText("fps: "+a.time.fps),this.texts.pos.setText("room: "+f.room.idx),this.texts.end.setText("end: "+this.maze.endRoom),this.texts.key.setText("key: "+this.maze.keyRoom));var i=0;f.body.velocity.setTo(0,0),this.cursors.up.isDown||a.input.keyboard.isDown(Phaser.Keyboard.W)?(f.body.velocity.y=-e.PLAYER_SPEED,i+=1):this.cursors.down.isDown||a.input.keyboard.isDown(Phaser.Keyboard.S)?(f.body.velocity.y=e.PLAYER_SPEED,i+=2):this.cursors.left.isDown||a.input.keyboard.isDown(Phaser.Keyboard.A)?(f.body.velocity.x=-e.PLAYER_SPEED,i+=10):(this.cursors.right.isDown||a.input.keyboard.isDown(Phaser.Keyboard.D))&&(f.body.velocity.x=e.PLAYER_SPEED,i+=20),1===i?f.angle=0:2===i?f.angle=180:i>0&&20>i?f.angle=-90:i>=20?f.angle=90:f.animations.stop(),a.input.keyboard.isDown(Phaser.Keyboard.M)&&f.musicKeyTime<a.time.now?(f.musicKeyTime=a.time.now+500,this.toggleMusic()):a.input.keyboard.isDown(Phaser.Keyboard.N)&&f.musicKeyTime<a.time.now&&(f.musicKeyTime=a.time.now+500,this.soundOn=!this.soundOn),d.each(this.monsters,function(b){c=b.obj,c.exists&&(b.roomIdx===f.room.idx||b.erratic)&&(b.type===e.MONSTER01?(c.x<f.x-10?c.body.velocity.x=e.MONSTER_SPEED:c.x>f.x+10&&(c.body.velocity.x=-e.MONSTER_SPEED),c.y<f.y-10?c.body.velocity.y=e.MONSTER_SPEED:c.y>f.y+10&&(c.body.velocity.y=-e.MONSTER_SPEED)):b.type===e.MONSTER02&&b.trackTime<a.time.now&&(b.trackTime=a.time.now+e.MONSTER_ACC_DELAY,c.body.velocity.setTo(0,0),a.physics.arcade.accelerateToObject(c,f,e.MONSTER_ACC,e.MONSTER_MAXSPEED,e.MONSTER_MAXSPEED)),c.angle=a.math.wrapAngle(90+a.math.radToDeg(a.physics.arcade.angleBetween(c,f),!1)),c.play("walk"))},this),(this.game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)||this.game.input.keyboard.isDown(Phaser.Keyboard.ENTER))&&a.time.now>f.lastOpenTime&&(f.lastOpenTime=a.time.now+550,d.each(f.room.obj.doors,function(c){return b=a.math.distance(f.x,f.y,c.x,c.y),85>b?void(c.isRed&&!f.hasKey?this.gamefactory.addText("The door is locked!"):(c.isOpen=!c.isOpen,c.frame=c.isOpen?2:0,this.playSound(["door1","door2"]))):void 0},this)),i>0&&(a.time.now>this.player.lastWalkSndTime&&(this.player.lastWalkSndTime=a.time.now+250,this.player.play("walk"),this.playSound(["walk2","walk3"])),d.each(f.room.obj.doors,function(b){a.physics.arcade.collide(f,b,h.onDoorCollision,null,h)}),d.each(f.room.obj.artifacts,function(b){a.physics.arcade.collide(f,b)}),g.scheme.hasKey&&g.obj.key&&a.physics.arcade.collide(f,g.obj.key,h.onKeyCollision,null,h)),this.isRoomEmpty||(a.time.now>this.player.lastAlarmTime&&(this.player.lastAlarmTime=a.time.now+1e3,this.playSound(["alarm1","alarm2"])),this.gamefactory.updateDepths(this.monsters),d.each(this.monsters,function(b){a.physics.arcade.collide(f,b.obj,h.onMonsterCollision,null,h)}))}},enterRoom:function(a,b,c,e){var f=this.player.room;f&&this.gamefactory.destroyRoom(f,this.monsters),this.player.x=b,this.player.y=c,this.player.body.velocity.setTo(0,0),this.player.animations.stop();var g;this.stopUpdate=!0,g=function(){this.stopUpdate=!1}.bind(this),this.player.room=this.gamefactory.addRoom(this.maze,a,this.monsters,g),this.isRoomEmpty=d.every(this.monsters,function(a){return!a.obj.exists}),!this.isRoomEmpty&&e&&(d.each(this.monsters,function(a){a.obj.exists=!1}),this.isRoomEmpty=!0)},onKeyCollision:function(a,b){var c="protagonist"===a.key?a:b,d="protagonist"===a.key?b:a;c.hasKey=!0,d.exists=!1,this.playSound("pickupkey"),this.maze.rooms[this.maze.keyRoom].scheme.hasKey=!1,this.gamefactory.addText("You found a key!")},onMonsterCollision:function(a,b){var c="protagonist"===a.key?a:b,d="protagonist"===a.key?b:a;e.debug("Monster hit"),this.stopUpdate=!0,d.body.velocity.setTo(0),c.body.velocity.setTo(0),c.alpha=.5,this.playMusic(null,!0);var f=function(){this.playMusic(!1),this.gamefactory.destroyAll(),this.game.state.start("gameover")}.bind(this);this.gamefactory.fadeoutAll(e.GAMEEND_FADE_DELAY,f)},onDoorCollision:function(a,b){var c="protagonist"===a.key?a:b,d="protagonist"===a.key?b:a;if(d.isOpen){if(d.isRed){if(c.hasKey){this.stopUpdate=!0,this.player.animations.stop(),this.playMusic(null,!0);var f=function(){this.playMusic(!1),this.gamefactory.destroyAll(),this.game.state.start("gamewin")}.bind(this);return void this.gamefactory.fadeoutAll(e.GAMEEND_FADE_DELAY,f)}throw"You shouldnt get here! :("}var g,h,i,j=this.player.room.idx;switch(d.aim){case e.DN:g=j-e.ROOMS_X,h=d.x,i=528;break;case e.DS:g=j+e.ROOMS_X,h=d.x,i=137;break;case e.DW:g=j-1,h=780,i=d.y;break;case e.DE:g=j+1,h=173,i=d.y;break;default:throw"u got it wrong kid!"}this.enterRoom(g,h,i)}},playSound:function(a){if(this.soundOn){var b;b="[object Array]"===Object.prototype.toString.call(a)?this.game.math.getRandom(a):a,this.sfx[b].play()}},playMusic:function(a,b){e.enableDebug||(a===!1?this.sfx.music.stop():a===!0?(this.sfx.music.volume=.5,this.sfx.music.loop=!0,this.sfx.music.play()):b===!0&&this.sfx.music.fadeOut(1e3))},toggleMusic:function(){this.playMusic(this.sfx.music.isPlaying?!1:!0)}},b.exports=c},{"../gamefactory":1,"../globals":2,lodash:11}],10:[function(a,b){"use strict";function c(){this.asset=null,this.ready=!1}c.prototype={preload:function(){var a={font:"18px Arial",fill:"#ffffff",align:"center"};this.asset=this.add.sprite(this.game.width/2,this.game.height/2,"preloader"),this.asset.anchor.setTo(.5,.5);var b=this.game.add.text(this.game.width/2,this.game.height/2-100,'Loading "The Bank Job" ...',a);b.anchor.setTo(.5,.5),this.load.onLoadComplete.addOnce(this.onLoadComplete,this),this.load.setPreloadSprite(this.asset),this.load.image("room01","assets/bg.jpg"),this.load.image("bags","assets/bags.png"),this.load.spritesheet("bankkey","assets/key.png",24,45),this.load.spritesheet("door_north","assets/door_top.png",165,70),this.load.spritesheet("door_south","assets/door_bottom.png",165,70),this.load.spritesheet("door_west","assets/door_left.png",104,165),this.load.spritesheet("door_east","assets/door_right.png",104,165),this.load.spritesheet("protagonist","assets/protagonist.png",66,54),this.load.spritesheet("monster","assets/cop_to_top.png",66,54),this.load.spritesheet("plant","assets/plant.png",65,65),this.load.spritesheet("chair","assets/chair.png",50,50),this.load.audio("door1",["assets/sfx/doorslam.ogg","assets/sfx/doorslam.m4a"]),this.load.audio("door2",["assets/sfx/doorslam02.ogg","assets/sfx/doorslam02.m4a"]),this.load.audio("pickupkey",["assets/sfx/pickupkey.ogg","assets/sfx/pickupkey.m4a"]),this.load.audio("walk2",["assets/sfx/walk02.ogg","assets/sfx/walk02.m4a"]),this.load.audio("walk3",["assets/sfx/walk03.ogg","assets/sfx/walk03.m4a"]),this.load.audio("alarm1",["assets/sfx/alarm01.ogg","assets/sfx/alarm01.m4a"]),this.load.audio("alarm2",["assets/sfx/alarm02.ogg","assets/sfx/alarm02.m4a"]),this.load.audio("music",["assets/sfx/thebankjob.ogg","assets/sfx/thebankjob.m4a"])},create:function(){this.asset.cropEnabled=!1},update:function(){this.ready&&this.game.state.start("menu")},onLoadComplete:function(){this.ready=!0}},b.exports=c},{}],11:[function(a,b,c){(function(a){(function(){function d(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function e(a,b){var c=typeof b;if(a=a.cache,"boolean"==c||null==b)return a[b]?0:-1;"number"!=c&&"string"!=c&&(c="object");var e="number"==c?b:u+b;return a=(a=a[c])&&a[e],"object"==c?a&&d(a,b)>-1?0:-1:a?0:-1}function f(a){var b=this.cache,c=typeof a;if("boolean"==c||null==a)b[a]=!0;else{"number"!=c&&"string"!=c&&(c="object");var d="number"==c?a:u+a,e=b[c]||(b[c]={});"object"==c?(e[d]||(e[d]=[])).push(a):e[d]=!0}}function g(a){return a.charCodeAt(0)}function h(a,b){for(var c=a.criteria,d=b.criteria,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.index-b.index}function i(a){var b=-1,c=a.length,d=a[0],e=a[c/2|0],g=a[c-1];if(d&&"object"==typeof d&&e&&"object"==typeof e&&g&&"object"==typeof g)return!1;var h=l();h["false"]=h["null"]=h["true"]=h.undefined=!1;var i=l();for(i.array=a,i.cache=h,i.push=f;++b<c;)i.push(a[b]);return i}function j(a){return"\\"+Y[a]}function k(){return r.pop()||[]}function l(){return s.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function m(a){a.length=0,r.length<w&&r.push(a)}function n(a){var b=a.cache;b&&n(b),a.array=a.cache=a.criteria=a.object=a.number=a.string=a.value=null,s.length<w&&s.push(a)}function o(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function p(a){function b(a){return a&&"object"==typeof a&&!Zd(a)&&Hd.call(a,"__wrapped__")?a:new c(a)}function c(a,b){this.__chain__=!!b,this.__wrapped__=a}function f(a){function b(){if(d){var a=o(d);Id.apply(a,arguments)}if(this instanceof b){var f=s(c.prototype),g=c.apply(f,a||arguments);return Eb(g)?g:f}return c.apply(e,a||arguments)}var c=a[0],d=a[2],e=a[4];return Yd(b,a),b}function r(a,b,c,d,e){if(c){var f=c(a);if("undefined"!=typeof f)return f}var g=Eb(a);if(!g)return a;var h=Ad.call(a);if(!U[h])return a;var i=Wd[h];switch(h){case N:case O:return new i(+a);case Q:case T:return new i(a);case S:return f=i(a.source,C.exec(a)),f.lastIndex=a.lastIndex,f}var j=Zd(a);if(b){var l=!d;d||(d=k()),e||(e=k());for(var n=d.length;n--;)if(d[n]==a)return e[n];f=j?i(a.length):{}}else f=j?o(a):ee({},a);return j&&(Hd.call(a,"index")&&(f.index=a.index),Hd.call(a,"input")&&(f.input=a.input)),b?(d.push(a),e.push(f),(j?Yb:he)(a,function(a,g){f[g]=r(a,b,c,d,e)}),l&&(m(d),m(e)),f):f}function s(a){return Eb(a)?Nd(a):{}}function w(a,b,c){if("function"!=typeof a)return Zc;if("undefined"==typeof b||!("prototype"in a))return a;var d=a.__bindData__;if("undefined"==typeof d&&(Xd.funcNames&&(d=!a.name),d=d||!Xd.funcDecomp,!d)){var e=Fd.call(a);Xd.funcNames||(d=!D.test(e)),d||(d=H.test(e),Yd(a,d))}if(d===!1||d!==!0&&1&d[1])return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Ic(a,b)}function Y(a){function b(){var a=i?g:this;if(e){var n=o(e);Id.apply(n,arguments)}if((f||k)&&(n||(n=o(arguments)),f&&Id.apply(n,f),k&&n.length<h))return d|=16,Y([c,l?d:-4&d,n,null,g,h]);if(n||(n=arguments),j&&(c=a[m]),this instanceof b){a=s(c.prototype);var p=c.apply(a,n);return Eb(p)?p:a}return c.apply(a,n)}var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=1&d,j=2&d,k=4&d,l=8&d,m=c;return Yd(b,a),b}function $(a,b){var c=-1,f=ib(),g=a?a.length:0,h=g>=v&&f===d,j=[];if(h){var k=i(b);k?(f=e,b=k):h=!1}for(;++c<g;){var l=a[c];f(b,l)<0&&j.push(l)}return h&&n(b),j}function _(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Zd(h)||mb(h))){b||(h=_(h,b,c));var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function ab(a,b,c,d,e,f){if(c){var g=c(a,b);if("undefined"!=typeof g)return!!g}if(a===b)return 0!==a||1/a==1/b;var h=typeof a,i=typeof b;if(!(a!==a||a&&X[h]||b&&X[i]))return!1;if(null==a||null==b)return a===b;var j=Ad.call(a),l=Ad.call(b);if(j==L&&(j=R),l==L&&(l=R),j!=l)return!1;switch(j){case N:case O:return+a==+b;case Q:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case S:case T:return a==vd(b)}var n=j==M;if(!n){var o=Hd.call(a,"__wrapped__"),p=Hd.call(b,"__wrapped__");if(o||p)return ab(o?a.__wrapped__:a,p?b.__wrapped__:b,c,d,e,f);if(j!=R)return!1;var q=a.constructor,r=b.constructor;if(q!=r&&!(Db(q)&&q instanceof q&&Db(r)&&r instanceof r)&&"constructor"in a&&"constructor"in b)return!1}var s=!e;e||(e=k()),f||(f=k());for(var t=e.length;t--;)if(e[t]==a)return f[t]==b;var u=0;if(g=!0,e.push(a),f.push(b),n){if(t=a.length,u=b.length,g=u==t,g||d)for(;u--;){var v=t,w=b[u];if(d)for(;v--&&!(g=ab(a[v],w,c,d,e,f)););else if(!(g=ab(a[u],w,c,d,e,f)))break}}else ge(b,function(b,h,i){return Hd.call(i,h)?(u++,g=Hd.call(a,h)&&ab(a[h],b,c,d,e,f)):void 0}),g&&!d&&ge(a,function(a,b,c){return Hd.call(c,b)?g=--u>-1:void 0});return e.pop(),f.pop(),s&&(m(e),m(f)),g}function bb(a,b,c,d,e){(Zd(b)?Yb:he)(b,function(b,f){var g,h,i=b,j=a[f];if(b&&((h=Zd(b))||ie(b))){for(var k=d.length;k--;)if(g=d[k]==b){j=e[k];break}if(!g){var l;c&&(i=c(j,b),(l="undefined"!=typeof i)&&(j=i)),l||(j=h?Zd(j)?j:[]:ie(j)?j:{}),d.push(b),e.push(j),l||bb(j,b,c,d,e)}}else c&&(i=c(j,b),"undefined"==typeof i&&(i=b)),"undefined"!=typeof i&&(j=i);a[f]=j})}function db(a,b){return a+Ed(Vd()*(b-a+1))}function eb(a,b,c){var f=-1,g=ib(),h=a?a.length:0,j=[],l=!b&&h>=v&&g===d,o=c||l?k():j;if(l){var p=i(o);g=e,o=p}for(;++f<h;){var q=a[f],r=c?c(q,f,a):q;(b?!f||o[o.length-1]!==r:g(o,r)<0)&&((c||l)&&o.push(r),j.push(q))}return l?(m(o.array),n(o)):c&&m(o),j}function fb(a){return function(c,d,e){var f={};d=b.createCallback(d,e,3);var g=-1,h=c?c.length:0;if("number"==typeof h)for(;++g<h;){var i=c[g];a(f,i,d(i,g,c),c)}else he(c,function(b,c,e){a(f,b,d(b,c,e),e)});return f}}function gb(a,b,c,d,e,g){var h=1&b,i=2&b,j=4&b,k=16&b,l=32&b;if(!i&&!Db(a))throw new wd;k&&!c.length&&(b&=-17,k=c=!1),l&&!d.length&&(b&=-33,l=d=!1);var m=a&&a.__bindData__;if(m&&m!==!0)return m=o(m),m[2]&&(m[2]=o(m[2])),m[3]&&(m[3]=o(m[3])),!h||1&m[1]||(m[4]=e),!h&&1&m[1]&&(b|=8),!j||4&m[1]||(m[5]=g),k&&Id.apply(m[2]||(m[2]=[]),c),l&&Ld.apply(m[3]||(m[3]=[]),d),m[1]|=b,gb.apply(null,m);var n=1==b||17===b?f:Y;return n([a,b,c,d,e,g])}function hb(a){return ae[a]}function ib(){var a=(a=b.indexOf)===rc?d:a;return a}function jb(a){return"function"==typeof a&&Bd.test(a)}function kb(a){var b,c;return a&&Ad.call(a)==R&&(b=a.constructor,!Db(b)||b instanceof b)?(ge(a,function(a,b){c=b}),"undefined"==typeof c||Hd.call(a,c)):!1}function lb(a){return be[a]}function mb(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ad.call(a)==L||!1}function nb(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c=b,b=!1),r(a,b,"function"==typeof c&&w(c,d,1))}function ob(a,b,c){return r(a,!0,"function"==typeof b&&w(b,c,1))}function pb(a,b){var c=s(a);return b?ee(c,b):c}function qb(a,c,d){var e;return c=b.createCallback(c,d,3),he(a,function(a,b,d){return c(a,b,d)?(e=b,!1):void 0}),e}function rb(a,c,d){var e;return c=b.createCallback(c,d,3),tb(a,function(a,b,d){return c(a,b,d)?(e=b,!1):void 0}),e}function sb(a,b,c){var d=[];ge(a,function(a,b){d.push(b,a)});var e=d.length;for(b=w(b,c,3);e--&&b(d[e--],d[e],a)!==!1;);return a}function tb(a,b,c){var d=_d(a),e=d.length;for(b=w(b,c,3);e--;){var f=d[e];if(b(a[f],f,a)===!1)break}return a}function ub(a){var b=[];return ge(a,function(a,c){Db(a)&&b.push(c)}),b.sort()}function vb(a,b){return a?Hd.call(a,b):!1}function wb(a){for(var b=-1,c=_d(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function xb(a){return a===!0||a===!1||a&&"object"==typeof a&&Ad.call(a)==N||!1}function yb(a){return a&&"object"==typeof a&&Ad.call(a)==O||!1}function zb(a){return a&&1===a.nodeType||!1}function Ab(a){var b=!0;if(!a)return b;var c=Ad.call(a),d=a.length;return c==M||c==T||c==L||c==R&&"number"==typeof d&&Db(a.splice)?!d:(he(a,function(){return b=!1}),b)}function Bb(a,b,c,d){return ab(a,b,"function"==typeof c&&w(c,d,2))}function Cb(a){return Pd(a)&&!Qd(parseFloat(a))}function Db(a){return"function"==typeof a}function Eb(a){return!(!a||!X[typeof a])}function Fb(a){return Hb(a)&&a!=+a}function Gb(a){return null===a}function Hb(a){return"number"==typeof a||a&&"object"==typeof a&&Ad.call(a)==Q||!1}function Ib(a){return a&&"object"==typeof a&&Ad.call(a)==S||!1}function Jb(a){return"string"==typeof a||a&&"object"==typeof a&&Ad.call(a)==T||!1}function Kb(a){return"undefined"==typeof a}function Lb(a,c,d){var e={};return c=b.createCallback(c,d,3),he(a,function(a,b,d){e[b]=c(a,b,d)}),e}function Mb(a){var b=arguments,c=2;if(!Eb(a))return a;if("number"!=typeof b[2]&&(c=b.length),c>3&&"function"==typeof b[c-2])var d=w(b[--c-1],b[c--],2);else c>2&&"function"==typeof b[c-1]&&(d=b[--c]);for(var e=o(arguments,1,c),f=-1,g=k(),h=k();++f<c;)bb(a,e[f],d,g,h);return m(g),m(h),a}function Nb(a,c,d){var e={};
if("function"!=typeof c){var f=[];ge(a,function(a,b){f.push(b)}),f=$(f,_(arguments,!0,!1,1));for(var g=-1,h=f.length;++g<h;){var i=f[g];e[i]=a[i]}}else c=b.createCallback(c,d,3),ge(a,function(a,b,d){c(a,b,d)||(e[b]=a)});return e}function Ob(a){for(var b=-1,c=_d(a),d=c.length,e=nd(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function Pb(a,c,d){var e={};if("function"!=typeof c)for(var f=-1,g=_(arguments,!0,!1,1),h=Eb(a)?g.length:0;++f<h;){var i=g[f];i in a&&(e[i]=a[i])}else c=b.createCallback(c,d,3),ge(a,function(a,b,d){c(a,b,d)&&(e[b]=a)});return e}function Qb(a,c,d,e){var f=Zd(a);if(null==d)if(f)d=[];else{var g=a&&a.constructor,h=g&&g.prototype;d=s(h)}return c&&(c=b.createCallback(c,e,4),(f?Yb:he)(a,function(a,b,e){return c(d,a,b,e)})),d}function Rb(a){for(var b=-1,c=_d(a),d=c.length,e=nd(d);++b<d;)e[b]=a[c[b]];return e}function Sb(a){for(var b=arguments,c=-1,d=_(b,!0,!1,1),e=b[2]&&b[2][b[1]]===a?1:d.length,f=nd(e);++c<e;)f[c]=a[d[c]];return f}function Tb(a,b,c){var d=-1,e=ib(),f=a?a.length:0,g=!1;return c=(0>c?Sd(0,f+c):c)||0,Zd(a)?g=e(a,b,c)>-1:"number"==typeof f?g=(Jb(a)?a.indexOf(b,c):e(a,b,c))>-1:he(a,function(a){return++d>=c?!(g=a===b):void 0}),g}function Ub(a,c,d){var e=!0;c=b.createCallback(c,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&(e=!!c(a[f],f,a)););else he(a,function(a,b,d){return e=!!c(a,b,d)});return e}function Vb(a,c,d){var e=[];c=b.createCallback(c,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g;){var h=a[f];c(h,f,a)&&e.push(h)}else he(a,function(a,b,d){c(a,b,d)&&e.push(a)});return e}function Wb(a,c,d){c=b.createCallback(c,d,3);var e=-1,f=a?a.length:0;if("number"!=typeof f){var g;return he(a,function(a,b,d){return c(a,b,d)?(g=a,!1):void 0}),g}for(;++e<f;){var h=a[e];if(c(h,e,a))return h}}function Xb(a,c,d){var e;return c=b.createCallback(c,d,3),Zb(a,function(a,b,d){return c(a,b,d)?(e=a,!1):void 0}),e}function Yb(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:w(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==!1;);else he(a,b);return a}function Zb(a,b,c){var d=a?a.length:0;if(b=b&&"undefined"==typeof c?b:w(b,c,3),"number"==typeof d)for(;d--&&b(a[d],d,a)!==!1;);else{var e=_d(a);d=e.length,he(a,function(a,c,f){return c=e?e[--d]:--d,b(f[c],c,f)})}return a}function $b(a,b){var c=o(arguments,2),d=-1,e="function"==typeof b,f=a?a.length:0,g=nd("number"==typeof f?f:0);return Yb(a,function(a){g[++d]=(e?b:a[b]).apply(a,c)}),g}function _b(a,c,d){var e=-1,f=a?a.length:0;if(c=b.createCallback(c,d,3),"number"==typeof f)for(var g=nd(f);++e<f;)g[e]=c(a[e],e,a);else g=[],he(a,function(a,b,d){g[++e]=c(a,b,d)});return g}function ac(a,c,d){var e=-1/0,f=e;if("function"!=typeof c&&d&&d[c]===a&&(c=null),null==c&&Zd(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];j>f&&(f=j)}else c=null==c&&Jb(a)?g:b.createCallback(c,d,3),Yb(a,function(a,b,d){var g=c(a,b,d);g>e&&(e=g,f=a)});return f}function bc(a,c,d){var e=1/0,f=e;if("function"!=typeof c&&d&&d[c]===a&&(c=null),null==c&&Zd(a))for(var h=-1,i=a.length;++h<i;){var j=a[h];f>j&&(f=j)}else c=null==c&&Jb(a)?g:b.createCallback(c,d,3),Yb(a,function(a,b,d){var g=c(a,b,d);e>g&&(e=g,f=a)});return f}function cc(a,c,d,e){if(!a)return d;var f=arguments.length<3;c=b.createCallback(c,e,4);var g=-1,h=a.length;if("number"==typeof h)for(f&&(d=a[++g]);++g<h;)d=c(d,a[g],g,a);else he(a,function(a,b,e){d=f?(f=!1,a):c(d,a,b,e)});return d}function dc(a,c,d,e){var f=arguments.length<3;return c=b.createCallback(c,e,4),Zb(a,function(a,b,e){d=f?(f=!1,a):c(d,a,b,e)}),d}function ec(a,c,d){return c=b.createCallback(c,d,3),Vb(a,function(a,b,d){return!c(a,b,d)})}function fc(a,b,c){if(a&&"number"!=typeof a.length&&(a=Rb(a)),null==b||c)return a?a[db(0,a.length-1)]:q;var d=gc(a);return d.length=Td(Sd(0,b),d.length),d}function gc(a){var b=-1,c=a?a.length:0,d=nd("number"==typeof c?c:0);return Yb(a,function(a){var c=db(0,++b);d[b]=d[c],d[c]=a}),d}function hc(a){var b=a?a.length:0;return"number"==typeof b?b:_d(a).length}function ic(a,c,d){var e;c=b.createCallback(c,d,3);var f=-1,g=a?a.length:0;if("number"==typeof g)for(;++f<g&&!(e=c(a[f],f,a)););else he(a,function(a,b,d){return!(e=c(a,b,d))});return!!e}function jc(a,c,d){var e=-1,f=Zd(c),g=a?a.length:0,i=nd("number"==typeof g?g:0);for(f||(c=b.createCallback(c,d,3)),Yb(a,function(a,b,d){var g=i[++e]=l();f?g.criteria=_b(c,function(b){return a[b]}):(g.criteria=k())[0]=c(a,b,d),g.index=e,g.value=a}),g=i.length,i.sort(h);g--;){var j=i[g];i[g]=j.value,f||m(j.criteria),n(j)}return i}function kc(a){return a&&"number"==typeof a.length?o(a):Rb(a)}function lc(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function mc(a){return $(a,_(arguments,!0,!0,1))}function nc(a,c,d){var e=-1,f=a?a.length:0;for(c=b.createCallback(c,d,3);++e<f;)if(c(a[e],e,a))return e;return-1}function oc(a,c,d){var e=a?a.length:0;for(c=b.createCallback(c,d,3);e--;)if(c(a[e],e,a))return e;return-1}function pc(a,c,d){var e=0,f=a?a.length:0;if("number"!=typeof c&&null!=c){var g=-1;for(c=b.createCallback(c,d,3);++g<f&&c(a[g],g,a);)e++}else if(e=c,null==e||d)return a?a[0]:q;return o(a,0,Td(Sd(0,e),f))}function qc(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(a=_b(a,c,d)),_(a,b)}function rc(a,b,c){if("number"==typeof c){var e=a?a.length:0;c=0>c?Sd(0,e+c):c||0}else if(c){var f=Ac(a,b);return a[f]===b?f:-1}return d(a,b,c)}function sc(a,c,d){var e=0,f=a?a.length:0;if("number"!=typeof c&&null!=c){var g=f;for(c=b.createCallback(c,d,3);g--&&c(a[g],g,a);)e++}else e=null==c||d?1:c||e;return o(a,0,Td(Sd(0,f-e),f))}function tc(){for(var a=[],b=-1,c=arguments.length,f=k(),g=ib(),h=g===d,j=k();++b<c;){var l=arguments[b];(Zd(l)||mb(l))&&(a.push(l),f.push(h&&l.length>=v&&i(b?a[b]:j)))}var o=a[0],p=-1,q=o?o.length:0,r=[];a:for(;++p<q;){var s=f[0];if(l=o[p],(s?e(s,l):g(j,l))<0){for(b=c,(s||j).push(l);--b;)if(s=f[b],(s?e(s,l):g(a[b],l))<0)continue a;r.push(l)}}for(;c--;)s=f[c],s&&n(s);return m(f),m(j),r}function uc(a,c,d){var e=0,f=a?a.length:0;if("number"!=typeof c&&null!=c){var g=f;for(c=b.createCallback(c,d,3);g--&&c(a[g],g,a);)e++}else if(e=c,null==e||d)return a?a[f-1]:q;return o(a,Sd(0,f-e))}function vc(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Sd(0,d+c):Td(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function wc(a){for(var b=arguments,c=0,d=b.length,e=a?a.length:0;++c<d;)for(var f=-1,g=b[c];++f<e;)a[f]===g&&(Kd.call(a,f--,1),e--);return a}function xc(a,b,c){a=+a||0,c="number"==typeof c?c:+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Sd(0,Cd((b-a)/(c||1))),f=nd(e);++d<e;)f[d]=a,a+=c;return f}function yc(a,c,d){var e=-1,f=a?a.length:0,g=[];for(c=b.createCallback(c,d,3);++e<f;){var h=a[e];c(h,e,a)&&(g.push(h),Kd.call(a,e--,1),f--)}return g}function zc(a,c,d){if("number"!=typeof c&&null!=c){var e=0,f=-1,g=a?a.length:0;for(c=b.createCallback(c,d,3);++f<g&&c(a[f],f,a);)e++}else e=null==c||d?1:Sd(0,c);return o(a,e)}function Ac(a,c,d,e){var f=0,g=a?a.length:f;for(d=d?b.createCallback(d,e,1):Zc,c=d(c);g>f;){var h=f+g>>>1;d(a[h])<c?f=h+1:g=h}return f}function Bc(){return eb(_(arguments,!0,!0))}function Cc(a,c,d,e){return"boolean"!=typeof c&&null!=c&&(e=d,d="function"!=typeof c&&e&&e[c]===a?null:c,c=!1),null!=d&&(d=b.createCallback(d,e,3)),eb(a,c,d)}function Dc(a){return $(a,o(arguments,1))}function Ec(){for(var a=-1,b=arguments.length;++a<b;){var c=arguments[a];if(Zd(c)||mb(c))var d=d?eb($(d,c).concat($(c,d))):c}return d||[]}function Fc(){for(var a=arguments.length>1?arguments:arguments[0],b=-1,c=a?ac(me(a,"length")):0,d=nd(0>c?0:c);++b<c;)d[b]=me(a,b);return d}function Gc(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Zd(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Hc(a,b){if(!Db(b))throw new wd;return function(){return--a<1?b.apply(this,arguments):void 0}}function Ic(a,b){return arguments.length>2?gb(a,17,o(arguments,2),null,b):gb(a,1,null,null,b)}function Jc(a){for(var b=arguments.length>1?_(arguments,!0,!1,1):ub(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=gb(a[e],1,null,null,a)}return a}function Kc(a,b){return arguments.length>2?gb(b,19,o(arguments,2),null,a):gb(b,3,null,null,a)}function Lc(){for(var a=arguments,b=a.length;b--;)if(!Db(a[b]))throw new wd;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Mc(a,b){return b="number"==typeof b?b:+b||a.length,gb(a,4,null,null,null,b)}function Nc(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!Db(a))throw new wd;if(b=Sd(0,b)||0,c===!0){var n=!0;m=!1}else Eb(c)&&(n=c.leading,l="maxWait"in c&&(Sd(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var o=function(){var c=b-(oe()-g);if(0>=c){e&&Dd(e);var l=j;e=i=j=q,l&&(k=oe(),f=a.apply(h,d),i||e||(d=h=null))}else i=Jd(o,c)},p=function(){i&&Dd(i),e=i=j=q,(m||l!==b)&&(k=oe(),f=a.apply(h,d),i||e||(d=h=null))};return function(){if(d=arguments,g=oe(),h=this,j=m&&(i||!n),l===!1)var c=n&&!i;else{e||n||(k=g);var q=l-(g-k),r=0>=q;r?(e&&(e=Dd(e)),k=g,f=a.apply(h,d)):e||(e=Jd(p,q))}return r&&i?i=Dd(i):i||b===l||(i=Jd(o,b)),c&&(r=!0,f=a.apply(h,d)),!r||i||e||(d=h=null),f}}function Oc(a){if(!Db(a))throw new wd;var b=o(arguments,1);return Jd(function(){a.apply(q,b)},1)}function Pc(a,b){if(!Db(a))throw new wd;var c=o(arguments,2);return Jd(function(){a.apply(q,c)},b)}function Qc(a,b){if(!Db(a))throw new wd;var c=function(){var d=c.cache,e=b?b.apply(this,arguments):u+arguments[0];return Hd.call(d,e)?d[e]:d[e]=a.apply(this,arguments)};return c.cache={},c}function Rc(a){var b,c;if(!Db(a))throw new wd;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Sc(a){return gb(a,16,o(arguments,1))}function Tc(a){return gb(a,32,null,o(arguments,1))}function Uc(a,b,c){var d=!0,e=!0;if(!Db(a))throw new wd;return c===!1?d=!1:Eb(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),V.leading=d,V.maxWait=b,V.trailing=e,Nc(a,b,V)}function Vc(a,b){return gb(b,16,[a])}function Wc(a){return function(){return a}}function Xc(a,b,c){var d=typeof a;if(null==a||"function"==d)return w(a,b,c);if("object"!=d)return bd(a);var e=_d(a),f=e[0],g=a[f];return 1!=e.length||g!==g||Eb(g)?function(b){for(var c=e.length,d=!1;c--&&(d=ab(b[e[c]],a[e[c]],null,!0)););return d}:function(a){var b=a[f];return g===b&&(0!==g||1/g==1/b)}}function Yc(a){return null==a?"":vd(a).replace(de,hb)}function Zc(a){return a}function $c(a,d,e){var f=!0,g=d&&ub(d);d&&(e||g.length)||(null==e&&(e=d),h=c,d=a,a=b,g=ub(d)),e===!1?f=!1:Eb(e)&&"chain"in e&&(f=e.chain);var h=a,i=Db(h);Yb(g,function(b){var c=a[b]=d[b];i&&(h.prototype[b]=function(){var b=this.__chain__,d=this.__wrapped__,e=[d];Id.apply(e,arguments);var g=c.apply(a,e);if(f||b){if(d===g&&Eb(g))return this;g=new h(g),g.__chain__=b}return g})})}function _c(){return a._=zd,this}function ad(){}function bd(a){return function(b){return b[a]}}function cd(a,b,c){var d=null==a,e=null==b;if(null==c&&("boolean"==typeof a&&e?(c=a,a=1):e||"boolean"!=typeof b||(c=b,e=!0)),d&&e&&(b=1),a=+a||0,e?(b=a,a=0):b=+b||0,c||a%1||b%1){var f=Vd();return Td(a+f*(b-a+parseFloat("1e-"+((f+"").length-1))),b)}return db(a,b)}function dd(a,b){if(a){var c=a[b];return Db(c)?a[b]():c}}function ed(a,c,d){var e=b.templateSettings;a=vd(a||""),d=fe({},d,e);var f,g=fe({},d.imports,e.imports),h=_d(g),i=Rb(g),k=0,l=d.interpolate||G,m="__p += '",n=ud((d.escape||G).source+"|"+l.source+"|"+(l===E?B:G).source+"|"+(d.evaluate||G).source+"|$","g");a.replace(n,function(b,c,d,e,g,h){return d||(d=e),m+=a.slice(k,h).replace(I,j),c&&(m+="' +\n__e("+c+") +\n'"),g&&(f=!0,m+="';\n"+g+";\n__p += '"),d&&(m+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),k=h+b.length,b}),m+="';\n";var o=d.variable,p=o;p||(o="obj",m="with ("+o+") {\n"+m+"\n}\n"),m=(f?m.replace(y,""):m).replace(z,"$1").replace(A,"$1;"),m="function("+o+") {\n"+(p?"":o+" || ("+o+" = {});\n")+"var __t, __p = '', __e = _.escape"+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var r="\n/*\n//# sourceURL="+(d.sourceURL||"/lodash/template/source["+K++ +"]")+"\n*/";try{var s=qd(h,"return "+m+r).apply(q,i)}catch(t){throw t.source=m,t}return c?s(c):(s.source=m,s)}function fd(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=nd(a);for(b=w(b,c,1);++d<a;)e[d]=b(d);return e}function gd(a){return null==a?"":vd(a).replace(ce,lb)}function hd(a){var b=++t;return vd(null==a?"":a)+b}function id(a){return a=new c(a),a.__chain__=!0,a}function jd(a,b){return b(a),a}function kd(){return this.__chain__=!0,this}function ld(){return vd(this.__wrapped__)}function md(){return this.__wrapped__}a=a?cb.defaults(Z.Object(),a,cb.pick(Z,J)):Z;var nd=a.Array,od=a.Boolean,pd=a.Date,qd=a.Function,rd=a.Math,sd=a.Number,td=a.Object,ud=a.RegExp,vd=a.String,wd=a.TypeError,xd=[],yd=td.prototype,zd=a._,Ad=yd.toString,Bd=ud("^"+vd(Ad).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Cd=rd.ceil,Dd=a.clearTimeout,Ed=rd.floor,Fd=qd.prototype.toString,Gd=jb(Gd=td.getPrototypeOf)&&Gd,Hd=yd.hasOwnProperty,Id=xd.push,Jd=a.setTimeout,Kd=xd.splice,Ld=xd.unshift,Md=function(){try{var a={},b=jb(b=td.defineProperty)&&b,c=b(a,a,a)&&b}catch(d){}return c}(),Nd=jb(Nd=td.create)&&Nd,Od=jb(Od=nd.isArray)&&Od,Pd=a.isFinite,Qd=a.isNaN,Rd=jb(Rd=td.keys)&&Rd,Sd=rd.max,Td=rd.min,Ud=a.parseInt,Vd=rd.random,Wd={};Wd[M]=nd,Wd[N]=od,Wd[O]=pd,Wd[P]=qd,Wd[R]=td,Wd[Q]=sd,Wd[S]=ud,Wd[T]=vd,c.prototype=b.prototype;var Xd=b.support={};Xd.funcDecomp=!jb(a.WinRTError)&&H.test(p),Xd.funcNames="string"==typeof qd.name,b.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:E,variable:"",imports:{_:b}},Nd||(s=function(){function b(){}return function(c){if(Eb(c)){b.prototype=c;var d=new b;b.prototype=null}return d||a.Object()}}());var Yd=Md?function(a,b){W.value=b,Md(a,"__bindData__",W)}:ad,Zd=Od||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ad.call(a)==M||!1},$d=function(a){var b,c=a,d=[];if(!c)return d;if(!X[typeof a])return d;for(b in c)Hd.call(c,b)&&d.push(b);return d},_d=Rd?function(a){return Eb(a)?Rd(a):[]}:$d,ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},be=wb(ae),ce=ud("("+_d(be).join("|")+")","g"),de=ud("["+_d(ae).join("")+"]","g"),ee=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i="number"==typeof c?2:g.length;if(i>3&&"function"==typeof g[i-2])var j=w(g[--i-1],g[i--],2);else i>2&&"function"==typeof g[i-1]&&(j=g[--i]);for(;++h<i;)if(e=g[h],e&&X[typeof e])for(var k=-1,l=X[typeof e]&&_d(e),m=l?l.length:0;++k<m;)d=l[k],f[d]=j?j(f[d],e[d]):e[d];return f},fe=function(a,b,c){var d,e=a,f=e;if(!e)return f;for(var g=arguments,h=0,i="number"==typeof c?2:g.length;++h<i;)if(e=g[h],e&&X[typeof e])for(var j=-1,k=X[typeof e]&&_d(e),l=k?k.length:0;++j<l;)d=k[j],"undefined"==typeof f[d]&&(f[d]=e[d]);return f},ge=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!X[typeof e])return f;b=b&&"undefined"==typeof c?b:w(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return f;return f},he=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!X[typeof e])return f;b=b&&"undefined"==typeof c?b:w(b,c,3);for(var g=-1,h=X[typeof e]&&_d(e),i=h?h.length:0;++g<i;)if(d=h[g],b(e[d],d,a)===!1)return f;return f},ie=Gd?function(a){if(!a||Ad.call(a)!=R)return!1;var b=a.valueOf,c=jb(b)&&(c=Gd(b))&&Gd(c);return c?a==c||Gd(a)==c:kb(a)}:kb,je=fb(function(a,b,c){Hd.call(a,c)?a[c]++:a[c]=1}),ke=fb(function(a,b,c){(Hd.call(a,c)?a[c]:a[c]=[]).push(b)}),le=fb(function(a,b,c){a[c]=b}),me=_b,ne=Vb,oe=jb(oe=pd.now)&&oe||function(){return(new pd).getTime()},pe=8==Ud(x+"08")?Ud:function(a,b){return Ud(Jb(a)?a.replace(F,""):a,b||0)};return b.after=Hc,b.assign=ee,b.at=Sb,b.bind=Ic,b.bindAll=Jc,b.bindKey=Kc,b.chain=id,b.compact=lc,b.compose=Lc,b.constant=Wc,b.countBy=je,b.create=pb,b.createCallback=Xc,b.curry=Mc,b.debounce=Nc,b.defaults=fe,b.defer=Oc,b.delay=Pc,b.difference=mc,b.filter=Vb,b.flatten=qc,b.forEach=Yb,b.forEachRight=Zb,b.forIn=ge,b.forInRight=sb,b.forOwn=he,b.forOwnRight=tb,b.functions=ub,b.groupBy=ke,b.indexBy=le,b.initial=sc,b.intersection=tc,b.invert=wb,b.invoke=$b,b.keys=_d,b.map=_b,b.mapValues=Lb,b.max=ac,b.memoize=Qc,b.merge=Mb,b.min=bc,b.omit=Nb,b.once=Rc,b.pairs=Ob,b.partial=Sc,b.partialRight=Tc,b.pick=Pb,b.pluck=me,b.property=bd,b.pull=wc,b.range=xc,b.reject=ec,b.remove=yc,b.rest=zc,b.shuffle=gc,b.sortBy=jc,b.tap=jd,b.throttle=Uc,b.times=fd,b.toArray=kc,b.transform=Qb,b.union=Bc,b.uniq=Cc,b.values=Rb,b.where=ne,b.without=Dc,b.wrap=Vc,b.xor=Ec,b.zip=Fc,b.zipObject=Gc,b.collect=_b,b.drop=zc,b.each=Yb,b.eachRight=Zb,b.extend=ee,b.methods=ub,b.object=Gc,b.select=Vb,b.tail=zc,b.unique=Cc,b.unzip=Fc,$c(b),b.clone=nb,b.cloneDeep=ob,b.contains=Tb,b.escape=Yc,b.every=Ub,b.find=Wb,b.findIndex=nc,b.findKey=qb,b.findLast=Xb,b.findLastIndex=oc,b.findLastKey=rb,b.has=vb,b.identity=Zc,b.indexOf=rc,b.isArguments=mb,b.isArray=Zd,b.isBoolean=xb,b.isDate=yb,b.isElement=zb,b.isEmpty=Ab,b.isEqual=Bb,b.isFinite=Cb,b.isFunction=Db,b.isNaN=Fb,b.isNull=Gb,b.isNumber=Hb,b.isObject=Eb,b.isPlainObject=ie,b.isRegExp=Ib,b.isString=Jb,b.isUndefined=Kb,b.lastIndexOf=vc,b.mixin=$c,b.noConflict=_c,b.noop=ad,b.now=oe,b.parseInt=pe,b.random=cd,b.reduce=cc,b.reduceRight=dc,b.result=dd,b.runInContext=p,b.size=hc,b.some=ic,b.sortedIndex=Ac,b.template=ed,b.unescape=gd,b.uniqueId=hd,b.all=Ub,b.any=ic,b.detect=Wb,b.findWhere=Wb,b.foldl=cc,b.foldr=dc,b.include=Tb,b.inject=cc,$c(function(){var a={};return he(b,function(c,d){b.prototype[d]||(a[d]=c)}),a}(),!1),b.first=pc,b.last=uc,b.sample=fc,b.take=pc,b.head=pc,he(b,function(a,d){var e="sample"!==d;b.prototype[d]||(b.prototype[d]=function(b,d){var f=this.__chain__,g=a(this.__wrapped__,b,d);return f||null!=b&&(!d||e&&"function"==typeof b)?new c(g,f):g})}),b.VERSION="2.4.1",b.prototype.chain=kd,b.prototype.toString=ld,b.prototype.value=md,b.prototype.valueOf=md,Yb(["join","pop","shift"],function(a){var d=xd[a];b.prototype[a]=function(){var a=this.__chain__,b=d.apply(this.__wrapped__,arguments);return a?new c(b,a):b}}),Yb(["push","reverse","sort","unshift"],function(a){var c=xd[a];b.prototype[a]=function(){return c.apply(this.__wrapped__,arguments),this}}),Yb(["concat","slice","splice"],function(a){var d=xd[a];b.prototype[a]=function(){return new c(d.apply(this.__wrapped__,arguments),this.__chain__)}}),b}var q,r=[],s=[],t=0,u=+new Date+"",v=75,w=40,x=" 	\f\n\r\u2028\u2029",y=/\b__p \+= '';/g,z=/\b(__p \+=) '' \+/g,A=/(__e\(.*?\)|\b__t\)) \+\n'';/g,B=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,D=/^\s*function[ \n\r\t]+\w/,E=/<%=([\s\S]+?)%>/g,F=RegExp("^["+x+"]*0+(?=.$)"),G=/($^)/,H=/\bthis\b/,I=/['\n\r\t\u2028\u2029\\]/g,J=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],K=0,L="[object Arguments]",M="[object Array]",N="[object Boolean]",O="[object Date]",P="[object Function]",Q="[object Number]",R="[object Object]",S="[object RegExp]",T="[object String]",U={};U[P]=!1,U[L]=U[M]=U[N]=U[O]=U[Q]=U[R]=U[S]=U[T]=!0;var V={leading:!1,maxWait:0,trailing:!1},W={configurable:!1,enumerable:!1,value:null,writable:!1},X={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Y={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},Z=X[typeof window]&&window||this,$=X[typeof c]&&c&&!c.nodeType&&c,_=X[typeof b]&&b&&!b.nodeType&&b,ab=_&&_.exports===$&&$,bb=X[typeof a]&&a;!bb||bb.global!==bb&&bb.window!==bb||(Z=bb);var cb=p();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Z._=cb,define(function(){return cb})):$&&_?ab?(_.exports=cb)._=cb:$._=cb:Z._=cb}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);